<style>
    .input-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
    }

    body {
        font-family: Arial, sans-serif;
    }
    
    form {
        max-width: 600px;
        margin: 0 auto;
    }
    
    label {
        display: block;
        margin-top: 8px;
        color: #333;
        font-weight: bold;
        font-family: Montserrat;
        font-size: 18px;
    }
    
    input[type="text"], select {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100px;
        height: 30px;
    }

    select {
        padding: 10px;
        height: auto;
        margin: 0;
        line-height: 1.2;
    }
    
    input[type="submit"] {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 20px;
        background-color: #4d78fb;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    
    input[type="submit"]:hover {
        background-color: #02008c;
    }
</style>
    

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Map display -->
<div id="map" style="height: 400px; width: 100%;"></div>

<!-- Input fields for API -->
<form id="apiForm">
    <div class="input-row">
        <label for="Texture_du_sol">Texture_du_sol:</label><br>
        <select id="Texture_du_sol" name="Texture_du_sol" onchange="toggleFields(this.value)">
            <option value="Argile lourde">Argile lourde</option>
            <option value="Argile">Argile</option>
            <option value="Argile sableuse">Argile sableuse</option>
            <option value="Limon">Limon</option>
            <option value="Limon sableux">Limon sableux</option>
            <option value="Limon trés sableux">Limon trés sableux</option>
            <option value="Sable argilo-limoneux">Sable argilo-limoneux</option>
            <option value="Sable">Sable</option>
        </select><br>

        <label for="Densité_apparente_des_motes_Bool">Densité_apparente_des_motes_Bool:</label>
        <select id="Densité_apparente_des_motes_Bool" name="Densité_apparente_des_motes_Bool" onchange="toggleFields(this.value)">
            <option value="non">Non</option>
            <option value="oui">Oui</option>
        </select>    

        <label for="Densité_apparente_des_motes">Densité_apparente_des_motes:</label>
        <input id="Densité_apparente_des_motes" type="text" step="0.01" name="Densité_apparente_des_motes">

        <label for="Densité_apparente_du_sol">Densité_apparente_du_sol:</label>
        <input id="Densité_apparente_du_sol" type="text" name="Densité_apparente_du_sol">

        <label for="Profondeur_des_racines">Profondeur_des_racines:</label>
        <input id="Profondeur_des_racines" type="text" name="Profondeur_des_racines">

        <label for="Pierrosité">Pierrosité:</label>
        <input id="Pierrosité" type="text" name="Pierrosité">

        <label for="Latitude">Latitude:</label>
        <input id="Latitude" type="text" name="Latitude">

        <label for="Longitude">Longitude:</label>
        <input id="Longitude" type="text" name="Longitude">

        <label for="Hauteur_de_linstallation">Hauteur_de_linstallation:</label>
        <input id="Hauteur_de_linstallation" type="text" name="Hauteur_de_linstallation">

        <label for="Taux_de_couverture">Taux_de_couverture:</label>
        <input id="Taux_de_couverture" type="text" name="Taux_de_couverture">

        <label for="Plant_name">Plant_name:</label>
        <select id="Plant_name" name="Plant_name" onchange="toggleFields(this.value)">
            <option value="Courgette">Courgette</option>
            <option value="Poireau">Poireau</option>
            <option value="Carotte">Carotte</option>
            <option value="Pomme de terre">Pomme de terre</option>
        </select>

        <label for="start_date">start_date:</label>
        <input id="start_date" type="text" name="start_date">

        <label for="end_date">end_date:</label>
        <input id="end_date" type="text" name="end_date">



        <label for="plantation_a_fleuraison_start">plantation_a_fleuraison_start:</label>
        <input id="plantation_a_fleuraison_start" type="text" name="plantation_a_fleuraison_start">

        <label for="plantation_a_fleuraison_end">plantation_a_fleuraison_end:</label>
        <input id="plantation_a_fleuraison_end" type="text" name="plantation_a_fleuraison_end">

        <label for="fleuraison_a_mi_recolte_start">fleuraison_a_mi_recolte_start:</label>
        <input id="fleuraison_a_mi_recolte_start" type="text" name="fleuraison_a_mi_recolte_start">

        <label for="fleuraison_a_mi_recolte_end">fleuraison_a_mi_recolte_end:</label>
        <input id="fleuraison_a_mi_recolte_end" type="text" name="fleuraison_a_mi_recolte_end">

        <label for="mi_recolte_fin_recolte_start">mi_recolte_fin_recolte_start:</label>
        <input id="mi_recolte_fin_recolte_start" type="text" name="mi_recolte_fin_recolte_start">

        <label for="mi_recolte_fin_recolte_end">mi_recolte_fin_recolte_end:</label>
        <input id="mi_recolte_fin_recolte_end" type="text" name="mi_recolte_fin_recolte_end">


        


        <label for="de_0_a_6_semaine_apres_semis_start">de_0_a_6_semaine_apres_semis_start:</label>
        <input id="de_0_a_6_semaine_apres_semis_start" type="text" name="de_0_a_6_semaine_apres_semis_start">

        <label for="de_0_a_6_semaine_apres_semis_end">de_0_a_6_semaine_apres_semis_end:</label>
        <input id="de_0_a_6_semaine_apres_semis_end" type="text" name="de_0_a_6_semaine_apres_semis_end">

        <label for="de_6_semaine_au_stade_start">de_6_semaine_au_stade_start:</label>
        <input id="de_6_semaine_au_stade_start" type="text" name="de_6_semaine_au_stade_start">

        <label for="de_6_semaine_au_stade_end">de_6_semaine_au_stade_end:</label>
        <input id="de_6_semaine_au_stade_end" type="text" name="de_6_semaine_au_stade_end">

        <label for="du_stade_a_recolte_start">du_stade_a_recolte_start:</label>
        <input id="du_stade_a_recolte_start" type="text" name="du_stade_a_recolte_start">

        <label for="du_stade_a_recolte_end">du_stade_a_recolte_end:</label>
        <input id="du_stade_a_recolte_end" type="text" name="du_stade_a_recolte_end">

        <input type="submit" value="Submit">
    </div>
</form>

<canvas id="myChart"></canvas>

<script>

    document.addEventListener("DOMContentLoaded", function() {
        toggleFields(document.getElementById('Densité_apparente_des_motes_Bool').value);
        carotteFields(document.getElementById('Plant_name').value);

        document.getElementById('Densité_apparente_des_motes_Bool').addEventListener('change', function() {
        toggleFields(this.value);
        });

        document.getElementById('Plant_name').addEventListener('change', function() {
            carotteFields(this.value);
        });
    });

    function toggleFields(value) {
        const densiteMotesField = document.getElementById('Densité_apparente_des_motes');
        const densiteSolField = document.getElementById('Densité_apparente_du_sol');
        const densiteMotesLabel = document.querySelector('label[for="Densité_apparente_des_motes"]');
        const densiteSolLabel = document.querySelector('label[for="Densité_apparente_du_sol"]');

        if (value === "oui") {
            densiteMotesField.style.display = 'block';
            densiteSolField.style.display = 'block';
            densiteMotesLabel.style.display = 'block';
            densiteSolLabel.style.display = 'block';
        } else {
            densiteMotesField.style.display = 'none';
            densiteSolField.style.display = 'none';
            densiteMotesLabel.style.display = 'none';
            densiteSolLabel.style.display = 'none';
        }

    }

    function carotteFields(value) {
        
        const de_0_a_6_semaine_apres_semis_start_label = document.querySelector('label[for="de_0_a_6_semaine_apres_semis_start"]');
        const de_0_a_6_semaine_apres_semis_start_input = document.getElementById("de_0_a_6_semaine_apres_semis_start");
        const de_0_a_6_semaine_apres_semis_end_label = document.querySelector('label[for="de_0_a_6_semaine_apres_semis_end"]');
        const de_0_a_6_semaine_apres_semis_end_input = document.getElementById("de_0_a_6_semaine_apres_semis_end");
        
        const de_6_semaine_au_stade_start_label = document.querySelector('label[for="de_6_semaine_au_stade_start"]');
        const de_6_semaine_au_stade_start_input = document.getElementById("de_6_semaine_au_stade_start");
        const de_6_semaine_au_stade_end_label = document.querySelector('label[for="de_6_semaine_au_stade_end"]');
        const de_6_semaine_au_stade_end_input = document.getElementById("de_6_semaine_au_stade_end");

        const du_stade_a_recolte_start_label = document.querySelector('label[for="du_stade_a_recolte_start"]');
        const du_stade_a_recolte_start_input = document.getElementById("du_stade_a_recolte_start");
        const du_stade_a_recolte_end_label = document.querySelector('label[for="du_stade_a_recolte_end"]');
        const du_stade_a_recolte_end_input = document.getElementById("du_stade_a_recolte_end");

        if (value === "Carotte") {
            de_0_a_6_semaine_apres_semis_start_input.style.display = 'block';
            de_0_a_6_semaine_apres_semis_start_label.style.display = 'block';
            de_0_a_6_semaine_apres_semis_end_input.style.display = 'block';
            de_0_a_6_semaine_apres_semis_end_label.style.display = 'block';
            
            de_6_semaine_au_stade_end_input.style.display = 'block';
            de_6_semaine_au_stade_end_label.style.display = 'block';
            de_6_semaine_au_stade_start_input.style.display = 'block';
            de_6_semaine_au_stade_start_label.style.display = 'block';

            du_stade_a_recolte_end_input.style.display = 'block';
            du_stade_a_recolte_end_label.style.display = 'block';
            du_stade_a_recolte_start_input.style.display = 'block';
            du_stade_a_recolte_start_label.style.display = 'block';
        } else {
            de_0_a_6_semaine_apres_semis_start_input.style.display = 'none';
            de_0_a_6_semaine_apres_semis_start_label.style.display = 'none';
            de_0_a_6_semaine_apres_semis_end_input.style.display = 'none';
            de_0_a_6_semaine_apres_semis_end_label.style.display = 'none';
            
            de_6_semaine_au_stade_end_input.style.display = 'none';
            de_6_semaine_au_stade_end_label.style.display = 'none';
            de_6_semaine_au_stade_start_input.style.display = 'none';
            de_6_semaine_au_stade_start_label.style.display = 'none';

            du_stade_a_recolte_end_input.style.display = 'none';
            du_stade_a_recolte_end_label.style.display = 'none';
            du_stade_a_recolte_start_input.style.display = 'none';
            du_stade_a_recolte_start_label.style.display = 'none';
        }
    }


    document.getElementById('apiForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const densiteApparenteDesMotesBoolValue = document.getElementById('Densité_apparente_des_motes_Bool').value;
        const densiteApparenteDesMotesBool = densiteApparenteDesMotesBoolValue === 'oui';

        const configuration_data = {
            "Texture_du_sol": document.getElementById('Texture_du_sol').value,
            "Densité_apparente_des_motes_Bool": densiteApparenteDesMotesBool,
            "Densité_apparente_des_motes": parseFloat(document.getElementById('Densité_apparente_des_motes').value),
            "Densité_apparente_du_sol": parseFloat(document.getElementById('Densité_apparente_du_sol').value),
            "Profondeur_des_racines": parseFloat(document.getElementById('Profondeur_des_racines').value),
            "Pierrosité": parseFloat(document.getElementById('Pierrosité').value),
            "Latitude": parseFloat(document.getElementById('Latitude').value),
            "Longitude": parseFloat(document.getElementById('Longitude').value),
            "Hauteur_de_linstallation": parseFloat(document.getElementById('Hauteur_de_linstallation').value),
            "Taux_de_couverture": parseFloat(document.getElementById('Taux_de_couverture').value),
            "Plant_name": document.getElementById('Plant_name').value,
            "start_date": document.getElementById('start_date').value,
            "end_date": document.getElementById('end_date').value,
            "plantation_a_fleuraison": [document.getElementById('plantation_a_fleuraison_start').value, document.getElementById('plantation_a_fleuraison_end').value],
            "fleuraison_a_mi_recolte": [document.getElementById('fleuraison_a_mi_recolte_start').value, document.getElementById('fleuraison_a_mi_recolte_end').value],
            "mi_recolte_fin_recolte": [document.getElementById('mi_recolte_fin_recolte_start').value, document.getElementById('mi_recolte_fin_recolte_end').value],
        };

        fetch('http://82.165.34.79/bilan_hydrique', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(configuration_data)
        })
            .then(response => response.json())
            .then(data => {
                createChart(data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    });

    let myChart;

    function createChart(data) {
        const ctx = document.getElementById('myChart').getContext('2d');

        if (myChart) {
            myChart.destroy();
        }

        const dates = Object.keys(data);
        const eau_utile_prog = dates.map(date => data[date].eau_utile);
        const RDU_prog = dates.map(date => data[date].RDU);
        const eau_utile_pv_prog = dates.map(date => data[date].eau_utile_pv);
        const capacité_au_champs_prog = dates.map(date => data[date].capacité_au_champs);
        const irrigation_prog = dates.map(date => data[date].irrigation)
        const irrigation_pv_prog = dates.map(date => data[date].irrigation_pv)


        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'eau Utile',
                    data: eau_utile_prog,
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.1
                },
                {
                    label: 'RDU',
                    data: RDU_prog,
                    fill: false,
                    borderColor: 'rgb(255, 99, 132)',
                    tension: 0.1
                },
                {
                    label: 'eau utile pv',
                    data: eau_utile_pv_prog,
                    fill: false,
                    borderColor: 'rgb(110, 70, 110)',
                    tension: 0.1
                },
                {
                    label: 'capacité_au_champs',
                    data: capacité_au_champs_prog,
                    fill: false,
                    borderColor: 'rgb(10, 250, 80)',
                    tension: 0.1
                },
                {
                    label: 'irrigation',
                    data: irrigation_prog,
                    fill: false,
                    borderColor: 'rgb(137, 66, 66)',
                    tension: 0.1
                },
                {
                    label: 'irrigation pv',
                    data: irrigation_pv_prog,
                    fill: false,
                    borderColor: 'rgd(11, 99, 102)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        display: true,
                        title: {
                            display: true,
                            text: 'eau utile / eau utile pv / RDU'
                        }
                    }
                }
            }
        });
    }

    var map;
    var marker;

    function initMap() {
        var initialLocation = { lat: -25.363, lng: 131.044 };

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: initialLocation
        });

        marker = new google.maps.Marker({
            position: initialLocation,
            map: map,
            draggable: true
        });

        google.maps.event.addListener(marker, 'dragend', function (evt) {
            document.getElementById('Latitude').value = evt.latLng.lat().toFixed(3);
            document.getElementById('Longitude').value = evt.latLng.lng().toFixed(3);
        });

        google.maps.event.addListener(map, 'click', function (evt) {
            marker.setPosition(evt.latLng);
            document.getElementById('Latitude').value = evt.latLng.lat().toFixed(3);
            document.getElementById('Longitude').value = evt.latLng.lng().toFixed(3);
        });
    }
</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=API_key&callback=initMap">
</script>